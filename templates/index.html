{% extends "layout.html" %}
{% import "macros.html" as m %}

{% block content %}

{# Header #}
<nav>
    <a href="/">{% if config.extra.logo %}
        <img src={{config.extra.logo}} />
        {% endif %}
        <h3>{{ config.title }}</h3>
    </a>
</nav>

{# About #}
<section class="container">
    <h2>About</h2>
    {# Get about page content from the `about.md` file in content #}
    {% set about = get_page(path="about.md") %}
    {{ about.content | safe }}
</section>

<section class="container">
    <h3>Community</h3>
    <div style="display: flex; gap: 2em;">
        <div style="display: flex; flex-direction: column;">
            <h4 style="margin: 0;">Discord</h4>
            <p>Join RustAudio on Discord to keep up with audio development within the Rust ecosystem, get help with
                DSP, collaborate on projects, and everything in-between.
                </br>
                <a class="button" style="margin-top: 1em" href={{config.extra.discord_invite}} target="_blank">Join
                    Discord</a>
            </p>
        </div>
        <a href={{config.extra.discord_invite}} class="hide-small" target="_blank">
            <img style="border-radius: 24px"
                src="https://discord.com/api/guilds/{{config.extra.discord_server_id}}/widget.png?style=banner3" />
        </a>
    </div>
    <hr>
    <h4 style="margin: 0;">Forums</h4>
    <p>Visit <a href="//rust-audio.discourse.group">the RustAudio forums</a> on Discourse</p>
</section>

<hr>

{# Resources #}
<section class="container">
    <h2>Resources</h2>

    <article>
        <h2>Audio plugin formats</h2>
        {% set formats = load_data(path="content/formats.toml") %}
        {% for format in formats.formats %}
        <h3>
            <pre>{{format.name}}</pre>
        </h3>

        <small>{% if format.proprietary %}Proprietary{% else %}Free & Open Source
            {% endif %}</small>

        <p>{{format.description}}</p>

        {% if format.resources %}
        <h4>Resources</h4>
        <ul>
            {% for resource in format.resources %}
            <a href={{resource.url}}>
                <li>{{resource.name}}</li>
            </a>
            {% endfor %}
        </ul>
        {% endif %}

        {% if format.crates %}
        <h4>Crates</h4>
        <ul>
            {% for crate in format.crates %}
            <a href={{crate.url}}>
                <li>{{crate.name}}</li>
            </a>
            {% endfor %}
        </ul>
        {% endif %}


        {% endfor %}
    </article>
    <hr>
    <article>
        <h1>DSP resources</h1>
        {% set resources = load_data(path="content/resources.toml") %}
        {% for group, resources in resources.resources | group_by(attribute="category") %}
        <h2>{{group | capitalize}}</h2>
        <ul>
            {% for resource in resources %}
            <a href={{resource.url}}>
                <li>{{resource.name}}</li>
            </a>
            {% endfor %}
        </ul>
        {% endfor %}
    </article>
</section>

<hr>

{# Crates #}

<section>
    <h2 class="container-full">RustAudio Crates</h2>
    <div class="crates">
        {% set crates = load_data(url=config.extra.repos_url, format="json") %}
        {% for crate in crates | sort(attribute="updated_at") | reverse %}
        <div class="crate">
            <a href={{crate.svn_url}}>
                <h5>
                    <pre>{{ crate.name }}</pre>
                </h5>
            </a>
            <div class="details">
                <div class="stars">{{ crate.stargazers_count }} â˜†</div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>

{% endblock content %}