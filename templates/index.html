{% extends "layout.html" %}
{% import "macros.html" as m %}

{% block content %}

{# About #}
<section class="container">
    <h2>Rust Audio</h2>
    {# Get about page content from the `about.md` file in content #}
    {% set about = get_page(path="about.md") %}
    {{ about.content | safe }}
</section>

<section class="container">
    <h3>Community</h3>
    <div style="display: flex; flex-direction: column;">
        <p>Join Rust Audio on Discord to keep up with audio development within the Rust ecosystem, get help with
            DSP, collaborate on projects, and everything in-between.
        </p>
    </div>
    <a href={{config.extra.discord_invite}} aria-label="Join our Discord server" target="_blank">
        <img style="border-radius: 24px"
            src="https://discord.com/api/guilds/{{config.extra.discord_server_id}}/widget.png?style=banner2" />
    </a>
</section>

<script>
    (function () {

        var element = document.querySelector("#crates");
        let tags = document.querySelectorAll(".filter-tag");
        var filter_element = document.querySelector(".filters");
        var filters = [];
        [].forEach.call(tags, function (tag) {
            filters.push(tag.dataset.keyword)
        });
        // Dedup
        filters = [...new Set(filters)].sort(function (a, b) {
            return a.localeCompare(b);
        });
        enabled_filters = []

        function build_filters() {
            filter_element.innerHTML = "";
            filters.forEach((filter) => {
                var filter_el = document.createElement("DIV");
                filter_el.classList.add("tag");
                filter_el.classList.add("filter-tag");
                filter_el.dataset.keyword = filter;
                filter_el.innerText = filter;
                filter_element.appendChild(filter_el);
            });
        }

        function filter_entries() {
            // Get all filterable elements
            let elements = document.querySelectorAll("#crates .crate");
            [].forEach.call(elements, function (el) {
                let keywords = el.dataset.keywords.split(" ");
                let is_active = keywords.some(r => enabled_filters.indexOf(r) >= 0);
                if (enabled_filters.length == 0) {
                    el.style.display = "block";
                } else {
                    if (!is_active) {
                        el.style.display = "none";
                    } else {
                        el.style.display = "block";
                    }
                }
            });
        }

        function toggle_filter(keyword) {
            let tags_with_keyword = document.querySelectorAll(`[data-keyword="${keyword}"]`);
            let index = enabled_filters.indexOf(keyword);
            if (index > -1) {
                console.log("toggling off tag");
                // exists, toggle off
                enabled_filters.splice(index, 1);
                [].forEach.call(tags_with_keyword, function (el) {
                    el.classList.remove("toggled");
                });
            } else {
                console.log("toggling on tag");
                // doesn't yet exist, push
                enabled_filters.push(keyword);
                // toggle style for all tags
                [].forEach.call(tags_with_keyword, function (el) {
                    el.classList.add("toggled");
                });
            }
            filter_entries();
        }

        build_filters();

        tags = document.querySelectorAll(".filter-tag");
        [].forEach.call(tags, function (tag) {
            tag.addEventListener("click", (ev) => {
                let keyword = tag.dataset.keyword;
                toggle_filter(keyword);
            });
        });

    })();
</script>

{% endblock content %}
